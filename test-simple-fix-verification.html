<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .jdgm-prev-badge {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 2px solid #dee2e6;
            cursor: pointer;
            transition: all 0.2s;
        }
        .jdgm-prev-badge:hover {
            background: #e9ecef;
            border-color: #007bff;
        }
        .jdgm-star {
            color: #A889A8;
            font-size: 18px;
        }
        .jdgm-prev-badge__text {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        .btn:hover { background: #0056b3; }
        .btn.danger { background: #dc3545; }
        .btn.danger:hover { background: #c82333; }
        .btn.success { background: #28a745; }
        .btn.success:hover { background: #218838; }
        
        #results {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
        .success-box {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid #c3e6cb;
        }
        .test-grid {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }
        .expected {
            font-style: italic;
            color: #28a745;
            font-size: 12px;
            margin-top: 5px;
        }
        .click-counter {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Judge.me ç®€åŒ–ä¿®å¤éªŒè¯</h1>
        <div class="success-box">
            <strong>ç®€åŒ–æ–¹æ¡ˆï¼š</strong>ç›´æ¥æ›¿æ¢æ–‡æœ¬å†…å®¹ï¼Œä¿å­˜åŸå§‹æ•°æ®ç”¨äºåŠŸèƒ½æ¢å¤ã€‚<br>
            <strong>é¢„æœŸæ•ˆæœï¼š</strong>æ˜¾ç¤ºçº¯ (æ•°å­—) æ ¼å¼ï¼Œä¸åº”è¯¥æœ‰åŸæ–‡+æ•°å­—çš„æ··åˆæ˜¾ç¤ºã€‚
        </div>
        
        <div style="text-align: center; margin: 25px 0;">
            <button class="btn" onclick="runTest()">ğŸ”„ æ‰§è¡Œæµ‹è¯•</button>
            <button class="btn success" onclick="testAllClicks()">ğŸ‘† æµ‹è¯•æ‰€æœ‰ç‚¹å‡»</button>
            <button class="btn danger" onclick="restore()">ğŸ”„ æ¢å¤åŸæ–‡</button>
            <button class="btn" onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <div class="click-counter" id="clickCounter">
            ç‚¹å‡»è®¡æ•°å™¨ï¼šå‡†å¤‡å°±ç»ª
        </div>

        <div class="test-grid">
            <div class="jdgm-prev-badge" onclick="handleClick('æ—¥è¯­reviews', this)">
                <span class="jdgm-star">â˜…â˜…â˜…â˜…â˜…</span>
                <span class="jdgm-prev-badge__text">15ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
                <div class="expected">é¢„æœŸæ˜¾ç¤º: (15)</div>
            </div>
            
            <div class="jdgm-prev-badge" onclick="handleClick('è‹±è¯­reviews', this)">
                <span class="jdgm-star">â˜…â˜…â˜…â˜…â˜†</span>
                <span class="jdgm-prev-badge__text">23 reviews</span>
                <div class="expected">é¢„æœŸæ˜¾ç¤º: (23)</div>
            </div>
            
            <div class="jdgm-prev-badge" onclick="handleClick('è‹±è¯­customer reviews', this)">
                <span class="jdgm-star">â˜…â˜…â˜…â˜†â˜†</span>
                <span class="jdgm-prev-badge__text">87 customer reviews</span>
                <div class="expected">é¢„æœŸæ˜¾ç¤º: (87)</div>
            </div>
            
            <div class="jdgm-prev-badge" onclick="handleClick('å•æ•°review', this)">
                <span class="jdgm-star">â˜…â˜…â˜…â˜…â˜…</span>
                <span class="jdgm-prev-badge__text">1 review</span>
                <div class="expected">é¢„æœŸæ˜¾ç¤º: (1)</div>
            </div>
            
            <div class="jdgm-prev-badge" onclick="handleClick('å¤šå•è¯review(s)', this)">
                <span class="jdgm-star">â˜…â˜…â˜…â˜…â˜†</span>
                <span class="jdgm-prev-badge__text">42 review(s)</span>
                <div class="expected">é¢„æœŸæ˜¾ç¤º: (42)</div>
            </div>
        </div>

        <div id="results"></div>
    </div>

    <script src="assets/judgeme-simple-fix.js"></script>
    <script>
        const resultsEl = document.getElementById('results');
        const clickCounterEl = document.getElementById('clickCounter');
        let clickCount = 0;
        
        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const colors = {
                'success': '#28a745',
                'error': '#dc3545',
                'warning': '#ffc107',
                'info': '#007bff'
            };
            const color = colors[type] || '#007bff';
            resultsEl.innerHTML += `<div style="color: ${color}; margin: 3px 0; border-left: 3px solid ${color}; padding-left: 8px;">[${time}] ${message}</div>`;
            resultsEl.scrollTop = resultsEl.scrollHeight;
        }
        
        function clearResults() {
            resultsEl.innerHTML = '';
            clickCount = 0;
            updateClickCounter();
        }
        
        function updateClickCounter() {
            clickCounterEl.textContent = `ç‚¹å‡»è®¡æ•°å™¨ï¼š${clickCount} æ¬¡ç‚¹å‡»`;
        }
        
        function runTest() {
            log('ğŸ”„ å¼€å§‹ç®€åŒ–ä¿®å¤æµ‹è¯•...', 'info');
            
            if (window.judgemeSimpleFix) {
                const processed = window.judgemeSimpleFix.process();
                log(`å¤„ç†äº† ${processed} ä¸ªå…ƒç´ `, 'info');
                
                // ç­‰å¾…å¤„ç†å®Œæˆåæ£€æŸ¥ç»“æœ
                setTimeout(() => {
                    verifyResults();
                }, 300);
            } else {
                log('âŒ ç®€åŒ–ä¿®å¤å™¨æœªåŠ è½½ï¼', 'error');
            }
        }
        
        function verifyResults() {
            log('ğŸ” éªŒè¯ç®€åŒ–ä¿®å¤ç»“æœ...', 'info');
            
            const textElements = document.querySelectorAll('.jdgm-prev-badge__text');
            let successCount = 0;
            let totalCount = textElements.length;
            
            textElements.forEach((element, index) => {
                const currentText = element.textContent.trim();
                const originalText = element.getAttribute('data-original-text');
                const isProcessed = element.hasAttribute('data-judgeme-processed');
                
                log(`å…ƒç´  ${index + 1}:`, 'info');
                log(`  å½“å‰æ˜¾ç¤º: "${currentText}"`, 'info');
                
                if (isProcessed && originalText) {
                    log(`  åŸå§‹æ–‡æœ¬: "${originalText}"`, 'info');
                    log(`  å¤„ç†çŠ¶æ€: å·²å¤„ç† âœ…`, 'success');
                } else {
                    log(`  å¤„ç†çŠ¶æ€: æœªå¤„ç†`, 'warning');
                }
                
                // æ£€æŸ¥æ˜¯å¦ä¸ºæ­£ç¡®çš„ (æ•°å­—) æ ¼å¼
                const correctFormat = /^\(\d+\)$/.test(currentText);
                if (correctFormat) {
                    successCount++;
                    log(`  æ ¼å¼éªŒè¯: æ­£ç¡® âœ…`, 'success');
                } else {
                    log(`  æ ¼å¼éªŒè¯: é”™è¯¯ âŒ (æœŸæœ›: (æ•°å­—), å®é™…: "${currentText}")`, 'error');
                }
                
                log('', 'info'); // ç©ºè¡Œåˆ†éš”
            });
            
            // ç”Ÿæˆæ€»ç»“
            const successRate = totalCount > 0 ? Math.round((successCount / totalCount) * 100) : 0;
            log(`ğŸ“Š æ€»ç»“æŠ¥å‘Šï¼š`, 'info');
            log(`  æˆåŠŸç‡: ${successCount}/${totalCount} (${successRate}%)`, successRate === 100 ? 'success' : 'warning');
            
            if (successCount === totalCount && totalCount > 0) {
                log('ğŸ‰ å®Œç¾ï¼æ‰€æœ‰æ–‡æœ¬æ›¿æ¢æˆåŠŸï¼Œå¯ä»¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼', 'success');
            } else if (successCount > 0) {
                log('âš ï¸ éƒ¨åˆ†æˆåŠŸï¼Œéœ€è¦è¿›ä¸€æ­¥è°ƒè¯•', 'warning');
            } else {
                log('âŒ æ›¿æ¢å¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥ä¿®å¤é€»è¾‘', 'error');
            }
        }
        
        function testAllClicks() {
            log('ğŸ‘† æµ‹è¯•æ‰€æœ‰å…ƒç´ çš„ç‚¹å‡»åŠŸèƒ½...', 'info');
            const badges = document.querySelectorAll('.jdgm-prev-badge');
            badges.forEach((badge, index) => {
                const textEl = badge.querySelector('.jdgm-prev-badge__text');
                const text = textEl.textContent;
                log(`è‡ªåŠ¨ç‚¹å‡»æµ‹è¯• ${index + 1}: "${text}"`, 'info');
                badge.click();
            });
        }
        
        function handleClick(type, element) {
            clickCount++;
            updateClickCounter();
            
            const textEl = element.querySelector('.jdgm-prev-badge__text');
            const currentText = textEl.textContent;
            const originalText = textEl.getAttribute('data-original-text');
            
            log(`ğŸ–±ï¸ ç”¨æˆ·ç‚¹å‡» ${type}:`, 'success');
            log(`  æ˜¾ç¤ºæ–‡æœ¬: "${currentText}"`, 'info');
            if (originalText) {
                log(`  åŸå§‹æ–‡æœ¬: "${originalText}"`, 'info');
            }
            log(`  åŠŸèƒ½çŠ¶æ€: ç‚¹å‡»äº‹ä»¶æ­£å¸¸è§¦å‘ âœ…`, 'success');
        }
        
        function restore() {
            log('ğŸ”„ æ¢å¤åŸå§‹çŠ¶æ€...', 'info');
            if (window.judgemeSimpleFix) {
                window.judgemeSimpleFix.restore();
                log('âœ… å·²æ¢å¤æ‰€æœ‰åŸå§‹æ–‡æœ¬', 'success');
                setTimeout(() => {
                    log('ğŸ” æ¢å¤åçŠ¶æ€æ£€æŸ¥...', 'info');
                    const textElements = document.querySelectorAll('.jdgm-prev-badge__text');
                    textElements.forEach((element, index) => {
                        const text = element.textContent.trim();
                        log(`  å…ƒç´  ${index + 1}: "${text}"`, 'info');
                    });
                }, 100);
            } else {
                log('âŒ æ¢å¤åŠŸèƒ½ä¸å¯ç”¨', 'error');
            }
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨æµ‹è¯•
        window.addEventListener('load', function() {
            log('ğŸ“„ ç®€åŒ–ä¿®å¤æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'info');
            log('ğŸ¯ ä½¿ç”¨ç›´æ¥æ–‡æœ¬æ›¿æ¢æ–¹æ¡ˆï¼Œä¿æŠ¤åŠŸèƒ½å®Œæ•´æ€§', 'info');
            
            setTimeout(() => {
                log('â° è‡ªåŠ¨æ‰§è¡Œä¿®å¤æµ‹è¯•...', 'info');
                runTest();
            }, 1000);
        });
    </script>
</body>
</html>
