<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Judge.me ä¿®å¤éªŒè¯ - ç®€åŒ–ç‰ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-case {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .jdgm-prev-badge {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .jdgm-prev-badge__stars {
            color: gold;
            margin-right: 8px;
        }
        .jdgm-star {
            font-size: 16px;
        }
        .jdgm-prev-badge__text {
            font-size: 14px;
            color: #666;
        }
        .log {
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .status {
            margin: 10px 0;
            font-weight: bold;
        }
        .success { color: green; }
        .failure { color: red; }
    </style>
</head>
<body>
    <h1>Judge.me ä¿®å¤éªŒè¯ - ç®€åŒ–ç‰ˆ</h1>
    
    <div class="test-case">
        <h3>æµ‹è¯•æ¡ˆä¾‹ 1: "8ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼"</h3>
        <div class="jdgm-prev-badge">
            <div class="jdgm-prev-badge__stars">
                <span class="jdgm-star">â˜…â˜…â˜…â˜…â˜…</span>
            </div>
            <div class="jdgm-prev-badge__text" id="test1">8ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
        </div>
        <div class="status" id="status1">ç­‰å¾…ä¿®å¤...</div>
    </div>
    
    <div class="test-case">
        <h3>æµ‹è¯•æ¡ˆä¾‹ 2: "23 reviews"</h3>
        <div class="jdgm-prev-badge">
            <div class="jdgm-prev-badge__stars">
                <span class="jdgm-star">â˜…â˜…â˜…â˜…â˜†</span>
            </div>
            <div class="jdgm-prev-badge__text" id="test2">23 reviews</div>
        </div>
        <div class="status" id="status2">ç­‰å¾…ä¿®å¤...</div>
    </div>
    
    <div class="test-case">
        <h3>æµ‹è¯•æ¡ˆä¾‹ 3: éšè—å…ƒç´  "9ãƒ¬ãƒ“ãƒ¥ãƒ¼"</h3>
        <div class="jdgm-prev-badge">
            <div class="jdgm-prev-badge__stars">
                <span class="jdgm-star">â˜…â˜…â˜…â˜…â˜…</span>
            </div>
            <div class="jdgm-prev-badge__text" id="test3" style="visibility: hidden;">9ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
        </div>
        <div class="status" id="status3">ç­‰å¾…ä¿®å¤...</div>
    </div>
    
    <div class="log" id="log"></div>
    
    <script>
        function log(message) {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        function checkElement(elementId, statusId) {
            const element = document.getElementById(elementId);
            const statusEl = document.getElementById(statusId);
            
            if (!element) {
                statusEl.textContent = 'å…ƒç´ æœªæ‰¾åˆ°';
                statusEl.className = 'status failure';
                return false;
            }
            
            const text = element.textContent.trim();
            const isCorrectFormat = /^\(\d+\)$/.test(text);
            
            const computedStyle = window.getComputedStyle(element);
            const isVisible = computedStyle.visibility !== 'hidden' && 
                             computedStyle.display !== 'none' &&
                             computedStyle.opacity !== '0';
            
            if (isCorrectFormat && isVisible) {
                statusEl.textContent = `âœ… ä¿®å¤æˆåŠŸ: "${text}"`;
                statusEl.className = 'status success';
                return true;
            } else {
                let issue = '';
                if (!isCorrectFormat) issue += `æ ¼å¼é”™è¯¯("${text}") `;
                if (!isVisible) issue += `ä¸å¯è§(${computedStyle.visibility}/${computedStyle.display}/${computedStyle.opacity}) `;
                
                statusEl.textContent = `âŒ ä¿®å¤å¤±è´¥: ${issue}`;
                statusEl.className = 'status failure';
                return false;
            }
        }
        
        function checkAllElements() {
            log('å¼€å§‹æ£€æŸ¥æ‰€æœ‰å…ƒç´ ...');
            
            const results = [
                checkElement('test1', 'status1'),
                checkElement('test2', 'status2'),
                checkElement('test3', 'status3')
            ];
            
            const successCount = results.filter(r => r).length;
            const totalCount = results.length;
            
            log(`æ£€æŸ¥å®Œæˆ: ${successCount}/${totalCount} ä¸ªå…ƒç´ ä¿®å¤æˆåŠŸ`);
            
            if (successCount === totalCount) {
                log('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡!');
            } else {
                log(`âš ï¸ è¿˜æœ‰ ${totalCount - successCount} ä¸ªå…ƒç´ éœ€è¦ä¿®å¤`);
            }
        }
        
        // åŠ è½½ä¿®å¤è„šæœ¬
        function loadScript() {
            log('å¼€å§‹åŠ è½½Judge.meä¿®å¤è„šæœ¬...');
            
            const script = document.createElement('script');
            script.src = 'assets/judgeme-modifier-robust.js';
            script.onload = function() {
                log('è„šæœ¬åŠ è½½æˆåŠŸï¼Œç­‰å¾…ä¿®å¤æ‰§è¡Œ...');
                
                // å»¶è¿Ÿæ£€æŸ¥ï¼Œç»™è„šæœ¬æ—¶é—´æ‰§è¡Œ
                setTimeout(() => checkAllElements(), 500);
                setTimeout(() => checkAllElements(), 1500);
                setTimeout(() => checkAllElements(), 3000);
            };
            script.onerror = function() {
                log('âŒ è„šæœ¬åŠ è½½å¤±è´¥');
            };
            
            document.body.appendChild(script);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•...');
            loadScript();
        });
        
        // å®šæœŸæ£€æŸ¥
        setInterval(checkAllElements, 5000);
    </script>
</body>
</html>
