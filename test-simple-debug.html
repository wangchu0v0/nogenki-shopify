<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•è°ƒè¯• - ä¸ºä»€ä¹ˆä¸å·¥ä½œ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .jdgm-prev-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }
        .jdgm-star {
            color: #A889A8;
            font-size: 16px;
        }
        .jdgm-prev-badge__text {
            font-size: 14px;
            color: #666;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            font-family: 'Courier New', monospace;
            height: 300px;
            overflow-y: auto;
            border-radius: 4px;
            font-size: 12px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç®€å•è°ƒè¯• - æ‰‹åŠ¨æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼</h1>
        
        <h3>ğŸ“‹ æµ‹è¯•æ•°æ®</h3>
        <div class="jdgm-prev-badge">
            <span class="jdgm-star">â˜…â˜…â˜…â˜…â˜…</span>
            <span class="jdgm-prev-badge__text">15ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
        </div>
        <div class="jdgm-prev-badge">
            <span class="jdgm-star">â˜…â˜…â˜…â˜…â˜†</span>
            <span class="jdgm-prev-badge__text">23 reviews</span>
        </div>
        <div class="jdgm-prev-badge">
            <span class="jdgm-star">â˜…â˜…â˜…â˜†â˜†</span>
            <span class="jdgm-prev-badge__text">156 customer reviews</span>
        </div>
        
        <div style="margin: 20px 0;">
            <button onclick="testRegex()">ğŸ§ª æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼</button>
            <button onclick="testProcessing()">âš™ï¸ æµ‹è¯•å¤„ç†é€»è¾‘</button>
            <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©º</button>
        </div>
    </div>

    <div class="container">
        <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
        <div id="log" class="log"></div>
    </div>

    <script>
        const logEl = document.getElementById('log');
        
        function log(message) {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.appendChild(div);
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        function clearLog() {
            logEl.innerHTML = '';
        }
        
        function testRegex() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼...');
            
            // æ‚¨å½“å‰çš„æ­£åˆ™è¡¨è¾¾å¼
            const currentRegex = /(\d+)[\s\u00A0]*(?:ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼|reviews?|review\(s\)|customer\s+reviews?|ä¸ªè¯„ä»·|å‰‡è©•åƒ¹)/i;
            
            // æµ‹è¯•æ•°æ®
            const testTexts = [
                '15ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼',
                '23 reviews',
                '156 customer reviews',
                '1 review',
                '5 review(s)',
                'Based on 89 reviews',
                '42ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼',
                '7reviews',  // æ²¡æœ‰ç©ºæ ¼
                '99  reviews'  // å¤šä¸ªç©ºæ ¼
            ];
            
            testTexts.forEach(text => {
                const match = text.match(currentRegex);
                if (match) {
                    log(`âœ… "${text}" â†’ åŒ¹é…æˆåŠŸï¼Œæå–: ${match[1]}`);
                } else {
                    log(`âŒ "${text}" â†’ æ²¡æœ‰åŒ¹é…`);
                }
            });
        }
        
        function testProcessing() {
            log('âš™ï¸ å¼€å§‹æµ‹è¯•å¤„ç†é€»è¾‘...');
            
            // æ¨¡æ‹Ÿæ‚¨çš„å¤„ç†å‡½æ•°
            function optimizedTextReplace(element) {
                const text = element.textContent.trim();
                log(`ğŸ” å¤„ç†å…ƒç´ : "${text}"`);
                
                // ä½¿ç”¨æ‚¨å½“å‰çš„æ­£åˆ™
                const reviewMatch = text.match(/(\d+)[\s\u00A0]*(?:ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼|reviews?|review\(s\)|customer\s+reviews?|ä¸ªè¯„ä»·|å‰‡è©•åƒ¹)/i);
                
                if (reviewMatch) {
                    const count = reviewMatch[1];
                    const newText = `(${count})`;
                    log(`  âœ… åŒ¹é…æˆåŠŸ: ${count} â†’ åº”è¯¥æ”¹ä¸º: ${newText}`);
                    
                    // å®é™…ä¿®æ”¹å…ƒç´ ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
                    element.textContent = newText;
                    element.style.cssText = `
                        font-size: 10px !important;
                        font-family: "Libre Baskerville", serif !important;
                        color: #666 !important;
                        transform: translateY(-1px) !important;
                        line-height: 1 !important;
                    `;
                    return true;
                } else {
                    log(`  âŒ æ²¡æœ‰åŒ¹é…åˆ°`);
                    return false;
                }
            }
            
            // è·å–æ‰€æœ‰æµ‹è¯•å…ƒç´ 
            const elements = document.querySelectorAll('.jdgm-prev-badge__text');
            log(`ğŸ“ æ‰¾åˆ° ${elements.length} ä¸ªå…ƒç´ `);
            
            let processed = 0;
            elements.forEach((element, index) => {
                log(`\n--- å¤„ç†å…ƒç´  ${index + 1} ---`);
                if (optimizedTextReplace(element)) {
                    processed++;
                }
            });
            
            log(`\nğŸ“Š æ€»ç»“: å¤„ç†äº† ${processed}/${elements.length} ä¸ªå…ƒç´ `);
            
            // æ£€æŸ¥å®é™…ç»“æœ
            setTimeout(() => {
                log('\nğŸ” æ£€æŸ¥å®é™…ç»“æœ:');
                const updatedElements = document.querySelectorAll('.jdgm-prev-badge__text');
                updatedElements.forEach((element, index) => {
                    const text = element.textContent.trim();
                    if (text.match(/^\(\d+\)$/)) {
                        log(`  âœ… å…ƒç´  ${index + 1}: "${text}" - æˆåŠŸ`);
                    } else {
                        log(`  âŒ å…ƒç´  ${index + 1}: "${text}" - å¤±è´¥`);
                    }
                });
            }, 100);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ');
            log('ğŸ¯ ç°åœ¨å¯ä»¥æ‰‹åŠ¨æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼å’Œå¤„ç†é€»è¾‘');
            log('ğŸ’¡ å¦‚æœå¤„ç†é€»è¾‘å·¥ä½œæ­£å¸¸ï¼Œè¯´æ˜é—®é¢˜åœ¨äºæ‚¨çš„JSæ–‡ä»¶æ²¡æœ‰æ­£ç¡®æ‰§è¡Œ');
        });
    </script>
</body>
</html>
