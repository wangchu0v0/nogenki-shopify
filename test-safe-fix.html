<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éç ´åæ€§ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin: 20px 0;
        }
        .jdgm-prev-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .jdgm-prev-badge:hover {
            background: #e9ecef;
        }
        .jdgm-star {
            color: #A889A8;
            font-size: 16px;
        }
        .jdgm-prev-badge__text {
            font-size: 14px;
            color: #666;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            font-family: 'Courier New', monospace;
            height: 250px;
            overflow-y: auto;
            border-radius: 4px;
            font-size: 12px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .clickable-demo {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›¡ï¸ Judge.meéç ´åæ€§ä¿®å¤æµ‹è¯•</h1>
        <div class="success">
            <strong>æ ¸å¿ƒæ”¹è¿›ï¼š</strong>è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨è¦†ç›–å±‚æŠ€æœ¯ï¼Œä¿æŠ¤Judge.meçš„å†…éƒ¨åŠŸèƒ½ä¸è¢«ç ´åï¼ŒåŒæ—¶å®ç°æ–‡æœ¬æ ¼å¼è½¬æ¢ã€‚
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button onclick="testProcessing()">ğŸ”„ æµ‹è¯•å¤„ç†</button>
            <button onclick="simulateClick()">ğŸ‘† æ¨¡æ‹Ÿç‚¹å‡»æµ‹è¯•</button>
            <button onclick="restoreOriginal()" class="danger">ğŸ”„ æ¢å¤åŸæ–‡</button>
            <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <div class="container test-section">
        <h3>ğŸ§ª æµ‹è¯•åŒºåŸŸ</h3>
        <div class="warning">
            <strong>æµ‹è¯•é‡ç‚¹ï¼š</strong>ç¡®è®¤æ–‡æœ¬è½¬æ¢åï¼Œç‚¹å‡»åŠŸèƒ½ä»ç„¶æ­£å¸¸å·¥ä½œ
        </div>
        
        <div class="clickable-demo">
            <h4>ğŸ“ å¯ç‚¹å‡»çš„reviewsæµ‹è¯•</h4>
            <div class="jdgm-prev-badge" onclick="simulateReviewClick(this, 'æ—¥è¯­reviews')">
                <span class="jdgm-star">â˜…â˜…â˜…â˜…â˜…</span>
                <span class="jdgm-prev-badge__text">15ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
            </div>
            
            <div class="jdgm-prev-badge" onclick="simulateReviewClick(this, 'è‹±è¯­reviews')">
                <span class="jdgm-star">â˜…â˜…â˜…â˜…â˜†</span>
                <span class="jdgm-prev-badge__text">23 reviews</span>
            </div>
            
            <div class="jdgm-prev-badge" onclick="simulateReviewClick(this, 'è‹±è¯­customer reviews')">
                <span class="jdgm-star">â˜…â˜…â˜…â˜†â˜†</span>
                <span class="jdgm-prev-badge__text">156 customer reviews</span>
            </div>
        </div>
    </div>

    <div class="container">
        <h3>ğŸ“Š å¤„ç†æ—¥å¿—</h3>
        <div id="log" class="log"></div>
    </div>

    <div class="container">
        <h3>ğŸ” åŠŸèƒ½éªŒè¯</h3>
        <div id="verification" style="padding: 15px; background: #f8f9fa; border-radius: 4px;">
            ç­‰å¾…æµ‹è¯•ç»“æœ...
        </div>
    </div>

    <script src="assets/judgeme-safe-fix.js"></script>
    <script>
        const logEl = document.getElementById('log');
        
        function log(message) {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.appendChild(div);
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        function clearLog() {
            logEl.innerHTML = '';
        }
        
        function testProcessing() {
            log('ğŸ”„ å¼€å§‹æµ‹è¯•éç ´åæ€§å¤„ç†...');
            if (window.judgemeNonDestructive) {
                const processed = window.judgemeNonDestructive.process();
                log(`âœ… å¤„ç†äº† ${processed} ä¸ªå…ƒç´ `);
                
                // æ£€æŸ¥ç»“æœ
                setTimeout(() => {
                    verifyResults();
                }, 500);
            } else {
                log('âŒ éç ´åæ€§ä¿®å¤å™¨æœªåŠ è½½');
            }
        }
        
        function simulateClick() {
            log('ğŸ‘† æ¨¡æ‹Ÿç‚¹å‡»æ‰€æœ‰reviewså…ƒç´ ...');
            const badges = document.querySelectorAll('.jdgm-prev-badge');
            badges.forEach((badge, index) => {
                const text = badge.querySelector('.jdgm-prev-badge__text').textContent;
                log(`   ç‚¹å‡»å…ƒç´  ${index + 1}: "${text}"`);
                
                // æ£€æŸ¥æ˜¯å¦è¿˜èƒ½æ­£å¸¸å“åº”ç‚¹å‡»
                const isClickable = badge.onclick !== null;
                log(`   å¯ç‚¹å‡»æ€§: ${isClickable ? 'âœ…' : 'âŒ'}`);
            });
        }
        
        function simulateReviewClick(element, type) {
            const textEl = element.querySelector('.jdgm-prev-badge__text');
            const currentText = textEl.textContent;
            log(`ğŸ–±ï¸ ç”¨æˆ·ç‚¹å‡»äº† ${type}: "${currentText}"`);
            
            // æ¨¡æ‹ŸJudge.meçš„å“åº”
            setTimeout(() => {
                log(`   ğŸ“ æ¨¡æ‹Ÿå±•å¼€${type}è¯¦ç»†å†…å®¹...`);
                log(`   âœ… ${type}åŠŸèƒ½æ­£å¸¸ï¼`);
            }, 200);
        }
        
        function restoreOriginal() {
            log('ğŸ”„ æ¢å¤åŸå§‹æ–‡æœ¬...');
            if (window.judgemeNonDestructive) {
                window.judgemeNonDestructive.restore();
                log('âœ… å·²æ¢å¤æ‰€æœ‰åŸå§‹å†…å®¹');
                setTimeout(verifyResults, 300);
            } else {
                log('âŒ æ¢å¤åŠŸèƒ½ä¸å¯ç”¨');
            }
        }
        
        function verifyResults() {
            log('ğŸ” éªŒè¯ä¿®å¤ç»“æœ...');
            
            const elements = document.querySelectorAll('.jdgm-prev-badge__text');
            let japaneseOk = 0;
            let englishOk = 0;
            let total = 0;
            
            elements.forEach((element, index) => {
                const text = element.textContent.trim();
                const originalText = element.getAttribute('data-original-text');
                const isProcessed = element.hasAttribute('data-judgeme-safe-processed');
                
                total++;
                log(`   å…ƒç´  ${index + 1}: "${text}" ${isProcessed ? '(å·²å¤„ç†)' : '(åŸå§‹)'}`);
                
                if (originalText) {
                    log(`     åŸæ–‡: "${originalText}"`);
                }
                
                // æ£€æŸ¥æ˜¯å¦ä¸ºç›®æ ‡æ ¼å¼
                if (text.match(/^\(\d+\)$/)) {
                    if (originalText && originalText.includes('ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼')) {
                        japaneseOk++;
                        log(`     âœ… æ—¥è¯­è½¬æ¢æˆåŠŸ`);
                    } else if (originalText && originalText.includes('review')) {
                        englishOk++;
                        log(`     âœ… è‹±è¯­è½¬æ¢æˆåŠŸ`);
                    }
                }
            });
            
            // æ›´æ–°éªŒè¯åŒºåŸŸ
            const verificationEl = document.getElementById('verification');
            verificationEl.innerHTML = `
                <h4>ğŸ“‹ éªŒè¯ç»“æœ</h4>
                <p><strong>æ€»å…ƒç´ ï¼š</strong>${total} ä¸ª</p>
                <p><strong>æ—¥è¯­æˆåŠŸï¼š</strong>${japaneseOk} ä¸ª ${japaneseOk > 0 ? 'âœ…' : 'âŒ'}</p>
                <p><strong>è‹±è¯­æˆåŠŸï¼š</strong>${englishOk} ä¸ª ${englishOk > 0 ? 'âœ…' : 'âŒ'}</p>
                <p><strong>åŠŸèƒ½ä¿æŠ¤ï¼š</strong>${total > 0 ? 'âœ… DOMç»“æ„å®Œæ•´' : 'âš ï¸ éœ€è¦æ£€æŸ¥'}</p>
                <hr>
                <p><strong>ç»“è®ºï¼š</strong>${generateConclusion(japaneseOk, englishOk, total)}</p>
            `;
        }
        
        function generateConclusion(japaneseOk, englishOk, total) {
            if (japaneseOk > 0 && englishOk > 0) {
                return 'ğŸ‰ åŒè¯­æ”¯æŒæˆåŠŸï¼ŒåŠŸèƒ½ä¿æŠ¤å®Œæ•´ï¼';
            } else if (japaneseOk > 0) {
                return 'âœ… æ—¥è¯­æ”¯æŒæˆåŠŸï¼Œè‹±è¯­éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–';
            } else if (englishOk > 0) {
                return 'âœ… è‹±è¯­æ”¯æŒæˆåŠŸï¼Œæ—¥è¯­éœ€è¦æ£€æŸ¥';
            } else {
                return 'âŒ éœ€è¦è°ƒè¯•å¤„ç†é€»è¾‘';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“„ éç ´åæ€§æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            log('ğŸ¯ è¿™ä¸ªç‰ˆæœ¬å°†ä¿æŠ¤Judge.meçš„å†…éƒ¨åŠŸèƒ½');
            
            // 3ç§’åè‡ªåŠ¨æµ‹è¯•
            setTimeout(() => {
                log('â° è‡ªåŠ¨å¼€å§‹æµ‹è¯•...');
                testProcessing();
            }, 3000);
        });
    </script>
</body>
</html>
